{
  "variables": {
	  "vpc_id": "",
	  "subnet_id": "",
	  "security_group_ids": ""
  },
  "builders": [{
    "type": "amazon-ebs",
    "access_key": "{{user `aws_access_key`}}",
    "secret_key": "{{user `aws_secret_key`}}",
	  "ssh_pty": "true",
    "region": "us-east-1",
    "source_ami": "ami-a4c7edb2",
    "instance_type": "t2.micro",
    "ssh_username": "ec2-user",
    "iam_instance_profile":"packer-s3-access",
	  "vpc_id": "{{user `vpc_id`}}",
	  "subnet_id": "{{user `subnet_id`}}",
	  "security_group_ids": "{{user `security_group_id`}}",
	  "launch_block_device_mappings": [{
		  "device_name":"/dev/sdh",
		  "delete_on_termination":"true",
		  "volume_size":"4",
		  "snapshot_id":"snap-5501c2c9",
		  "volume_type":"standard"
	  },
	  {
		  "device_name":"/dev/sdi",
		  "delete_on_termination":"true",
		  "volume_size":"3",
		  "snapshot_id":"snap-0a9aa38fbfcde2e9b",
		  "volume_type":"standard"
	  },
	  {
		  "device_name":"/dev/sdj",
		  "delete_on_termination":"true",
		  "volume_size":"1",
		  "snapshot_id":"snap-d9a8ae43",
		  "volume_type":"standard"
	  },
	  {
		  "device_name":"/dev/sdk",
		  "delete_on_termination":"true",
		  "volume_size":"1",
		  "snapshot_id":"snap-8193cc7a",
		  "volume_type":"standard"
	  },
	  {
		  "device_name":"/dev/sdl",
		  "delete_on_termination":"true",
		  "volume_size":"2",
		  "snapshot_id":"snap-9e472801",
		  "volume_type":"standard"
	  },
	  {
		  "device_name":"/dev/sdm",
		  "delete_on_termination":"true",
		  "volume_size":"1",
		  "snapshot_id":"snap-8abb108c",
		  "volume_type":"standard"
	  }],
    "ami_name": "Custom-Hardened-AMI {{isotime \"02-Jan-2006 15_04 MST\"}}",
    "ami_description": "Generated by Packer. 2017.03 Amazon Base image with CIS Remediation Script 2.0.0 and partitioning",
    "tags": {
		  "Name": "Custom Hardened Base AMI {{isotime \"02-Jan-2006 15:04 MST\"}}"
	  } ,
    "associate_public_ip_address":true


  }],
  "provisioners": [{
		"type": "file",
		"source": "CIS_Amazon_Linux_Benchmark_v2.0.0.sh",
		"destination": "/tmp/CIS_Amazon_Linux_Benchmark_v2.0.0.sh"
	},
	{
		"type": "file",
		"source": "configure.sh",
		"destination": "/tmp/configure.sh"
	},
	{
		"type": "shell",
		"inline": [
			"sleep 10",
			"sudo mv /tmp/configure.sh /usr/local/bin/",
			"sudo mv /tmp/CIS_Amazon_Linux_Benchmark_v2.0.0.sh /usr/local/bin/",
			"cd /",
			"sudo sh /usr/local/bin/configure.sh",
			"sleep 5",
			"sudo sh /usr/local/bin/CIS_Amazon_Linux_Benchmark_v2.0.0.sh",
			"sudo rm -f /usr/local/bin/configure.sh",
			"sudo rm -f /usr/local/bin/CIS_Amazon_Linux_Benchmark_v2.0.0.sh"
		]
	}]
}
